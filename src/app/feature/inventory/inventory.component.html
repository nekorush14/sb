<div class="inventory-container">
  <app-menu-bar></app-menu-bar>

  <div class="inventory-header">
    <h1 class="page-title">åœ¨åº«ç®¡ç†</h1>
  </div>

  <!-- åœ¨åº«æ¦‚è¦ã‚«ãƒ¼ãƒ‰ -->
  @if (summary(); as inventorySummary) {
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon">ğŸ“¦</div>
        <div class="card-content">
          <h3>ç·åœ¨åº«æ•°</h3>
          <p class="card-value">{{ inventorySummary.totalItems }}</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">ğŸ·ï¸</div>
        <div class="card-content">
          <h3>ã‚«ãƒ†ã‚´ãƒªãƒ¼</h3>
          <p class="card-value">{{ inventorySummary.totalCategories }}</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">ğŸ’°</div>
        <div class="card-content">
          <h3>ç·è³‡ç”£ä¾¡å€¤</h3>
          <p class="card-value">Â¥{{ inventorySummary.totalValue.toLocaleString() }}</p>
        </div>
      </div>
    </div>
  }

  <!-- ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º -->
  @if (alerts().length > 0) {
    <section class="alerts-section">
      <h2>è¦æ³¨æ„ã‚¢ã‚¤ãƒ†ãƒ </h2>
      <div class="alerts-container">
        @for (alert of alerts(); track alert.id) {
          <div class="alert-card" [class.expiring]="alert.alertType === 'expiring'" [class.low-stock]="alert.alertType === 'low-stock'">
            <div class="alert-icon">
              @if (alert.alertType === 'expiring') { âš ï¸ }
              @if (alert.alertType === 'low-stock') { ğŸ” }
            </div>
            <div class="alert-content">
              <h3>{{ alert.name }}</h3>
              @if (alert.alertType === 'expiring') {
                <p>æœŸé™ã¾ã§ã‚ã¨{{ alert.daysRemaining }}æ—¥</p>
              }
              @if (alert.alertType === 'low-stock') {
                <p>æ®‹ã‚Š{{ alert.quantity }}å€‹</p>
              }
            </div>
          </div>
        }
      </div>
    </section>
  }

  <!-- ãƒ¡ã‚¤ãƒ³åœ¨åº«ãƒªã‚¹ãƒˆ -->
  <section class="inventory-list-section">
    <div class="inventory-filters">
      <div class="search-box">
        <input type="text" placeholder="ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢..." class="search-input" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)">
        <span class="search-icon">ğŸ”</span>
      </div>
      <div class="list-actions">
        <button class="space-button add-button">
          <span class="button-icon">+</span>
          æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
        </button>
      </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
    @if (loading()) {
      <div class="loading-container">
        <div class="space-spinner"></div>
        <p>åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    }

    <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    @if (error(); as errorMsg) {
      <div class="error-container">
        <p class="error-message">{{ errorMsg }}</p>
        <button class="space-button" (click)="loadInventoryData()">å†è©¦è¡Œ</button>
      </div>
    }

    <!-- åœ¨åº«ãƒ†ãƒ¼ãƒ–ãƒ« -->
    @if (!loading() && !error() && items().length > 0) {
      <div class="inventory-table-container">
        <table class="inventory-table">
          <thead>
            <tr>
              <th (click)="sortColumn.set('name'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'name'" [class.asc]="sortColumn() === 'name' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'name' && sortDirection() === 'desc'">
                åå‰ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('quantity'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'quantity'" [class.asc]="sortColumn() === 'quantity' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'quantity' && sortDirection() === 'desc'">
                æ•°é‡ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('unit'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'unit'" [class.asc]="sortColumn() === 'unit' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'unit' && sortDirection() === 'desc'">
                å˜ä½ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('category'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'category'" [class.asc]="sortColumn() === 'category' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'category' && sortDirection() === 'desc'">
                ã‚«ãƒ†ã‚´ãƒªãƒ¼ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('location'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'location'" [class.asc]="sortColumn() === 'location' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'location' && sortDirection() === 'desc'">
                ä¿ç®¡å ´æ‰€ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('purchaseDate'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'purchaseDate'" [class.asc]="sortColumn() === 'purchaseDate' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'purchaseDate' && sortDirection() === 'desc'">
                è³¼å…¥æ—¥ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('price'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'price'" [class.asc]="sortColumn() === 'price' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'price' && sortDirection() === 'desc'">
                ä¾¡æ ¼ <span class="sort-icon"></span>
              </th>
              <th (click)="sortColumn.set('expiryDate'); sortDirection.set(sortDirection() === 'asc' ? 'desc' : 'asc')" class="sortable" [class.sorted]="sortColumn() === 'expiryDate'" [class.asc]="sortColumn() === 'expiryDate' && sortDirection() === 'asc'" [class.desc]="sortColumn() === 'expiryDate' && sortDirection() === 'desc'">
                æ¶ˆè²»æœŸé™ <span class="sort-icon"></span>
              </th>
              <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
            </tr>
          </thead>
          <tbody>
            @for (item of filteredItems(); track item.id) {
              <tr [class.low-stock]="isLowStock(item.quantity)" [class.expiring-soon]="isExpiringSoon(item.expiryDate)">
                <td class="item-name">
                  @if (item.imageUrl) {
                    <div class="item-image" [style.backgroundImage]="'url(' + item.imageUrl + ')'"></div>
                  } @else {
                    <div class="item-image no-image">No Image</div>
                  }
                  {{ item.name }}
                </td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unit }}</td>
                <td>{{ item.category }}</td>
                <td>{{ item.location }}</td>
                <td>{{ item.purchaseDate | date:'yyyy/MM/dd' }}</td>
                <td>Â¥{{ item.price.toLocaleString() }}</td>
                <td>
                  @if (item.expiryDate) {
                    {{ item.expiryDate | date:'yyyy/MM/dd' }}
                  } @else {
                    <span class="no-data">-</span>
                  }
                </td>
                <td class="actions">
                  <button class="action-button edit">ç·¨é›†</button>
                  <button class="action-button delete">å‰Šé™¤</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }

    <!-- ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ -->
    @if (!loading() && !error() && items().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p>æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¦åœ¨åº«ç®¡ç†ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
        <button class="space-button">æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ </button>
      </div>
    }

    <!-- æ¤œç´¢çµæœãŒãªã„å ´åˆ -->
    @if (!loading() && !error() && items().length > 0 && filteredItems().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">ğŸ”</div>
        <h3>æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p>ã€Œ{{ searchTerm() }}ã€ã«ä¸€è‡´ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
        <button class="space-button" (click)="searchTerm.set('')">æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢</button>
      </div>
    }
  </section>
</div>
